{
  "hash": "fb0ea1f5d5c2e5fdb87946fb00020303",
  "result": {
    "markdown": "---\ntitle: \"Fysisk samling 05.03. Multippel og logistisk regresjon\"\nauthor: \"Njål Foldnes\"\nfooter:  \"[hjem](https://njaalf.github.io/MPS-140/)\"\n   \nformat: \n  revealjs: \n    multiplex: true\n    transition: fade\n    slide-number: true\n    theme: slides.scss\n    chalkboard: true\nrevealjs-plugins:\n  - revealjs-text-resizer\n    \neditor: visual\nexecute:\n  echo: false\n  message: false\n  warning: false\n  freeze: auto\n---\n\n::: {.cell}\n\n:::\n\n\n# Multippel og logistisk regresjon\n\n## Multippel regresjon er et hovedverktøy i psykologi\n\n-   Fra forskningsspørsmålet identifiserer vi en *avhengig variabel* $Y$ som vi vil forklare variasjonen til\n-   Og en rekke *prediktorer* $X_1, X_2, \\ldots, X_k$ som skal forklare variasjonen i $Y$\n-   Modellen:\n\n$$ Y = \\beta_0 + \\beta_1 X_1+ \\beta_1 X_2+\\ldots +  \\beta_k X_k+\\epsilon$$\n\n## Fra forskningsspørsmål til regresjon\n\n-   Finne de viktigste prediktorene\n-   Sjekke forutsetninger: stort nok utvalg, unngå multikollinearitet[^1], sammenhengene er lineære, homoskedastisitet[^2], normalfordelte residualer\n-   Sjekke modellens totale forklaringskraft (Adjusted $R^2$ og $F$)\n-   Sjekke hver prediktors forklaringskraft\n-   Besvare forskningsspørsmålet\n\n[^1]: unngå høyt korrelerte prediktorer\n\n[^2]: residualene har konstant varians\n\n## Digitalt stress\n\nVi ser på noen data fra [stress-studien](https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2024.1297194/full). Dataene er i comma separated format og lastes ned [her](../data/stress_complete.csv)\n\nFor å lese inn data i mange format (excel, csv, spss, osv) trykk på *File\\>Import dataset* i Rstudio\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\")\nstressdata <- read.csv(\"../data/stress_complete.csv\") \nstressdata$X <- NULL#fjerne unødvendig variabel \"X\"\ndim(stressdata)#rader og søyler\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 581  23\n```\n:::\n\n```{.r .cell-code}\ncolnames(stressdata)#hvilke variabler\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"age\"                     \"sex\"                    \n [3] \"civil_status\"            \"education\"              \n [5] \"professional_experience\" \"COMP1\"                  \n [7] \"COMP2\"                   \"COMP3\"                  \n [9] \"COMP4\"                   \"COMP5\"                  \n[11] \"CONF1\"                   \"CONF2\"                  \n[13] \"CONF3\"                   \"CONF4\"                  \n[15] \"CONF5\"                   \"INSE1\"                  \n[17] \"INSE2\"                   \"INSE3\"                  \n[19] \"INSE4\"                   \"INSE5\"                  \n[21] \"alene\"                   \"leder\"                  \n[23] \"bransje\"                \n```\n:::\n:::\n\n\n## Beskrivende statistikk - Alder\n\nVi begynner alltid med å se på grafer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(stressdata$age)\n```\n\n::: {.cell-output-display}\n![](slides3a_files/figure-revealjs/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\nVi har outlier. Gjennomsnitt 52.6 og median: 42. Fjern outlier:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstressdata <- filter(stressdata, age < 70)\nnrow(stressdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 576\n```\n:::\n\n```{.r .cell-code}\nhist(stressdata$age)\n```\n\n::: {.cell-output-display}\n![](slides3a_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n## Beskrivende statistikk - Utdanningsnivå\n\nFire utdanningsnivå (grunnskole, vid.g, bachelor, master/phd)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqplot(stressdata$education)+geom_bar()\n```\n\n::: {.cell-output-display}\n![](slides3a_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\nAndeler\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop.table(table(stressdata$education))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n         1          2          3          4 \n0.01388889 0.30034722 0.39409722 0.29166667 \n```\n:::\n:::\n\n\n## Beskrivende statistikk kjønn\n\nVariabelen \"sex\" er kodet slik: 1=kvinne, 2=mann, 3=ikke oppgitt.\n\nVi forenkler med å lage en ny binær variabel \"kjønn\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstressdata$kjønn <- ifelse(stressdata$sex == 2,\"mann\", \"kvinne\")\nqplot(stressdata$kjønn)+geom_bar()\n```\n\n::: {.cell-output-display}\n![](slides3a_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Beskrivende statistikk bransje\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(stressdata$bransje )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n                    annet            Bygg og anlegg         Faglige tjenester \n                       47                        14                         5 \n     Finans og forsikring Forskning og undervisning           Helse og omsorg \n                       10                        47                       347 \n                 Industri                        IT  Offentlig administrasjon \n                        7                        23                        25 \n             Olje og gass                Varehandel \n                       34                        17 \n```\n:::\n:::\n\n\nVi forenkler ved å lage ny binær variabel for bransje (vi overskriver den gamle bransje)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstressdata$bransje <- ifelse(stressdata$bransje ==\"Helse og omsorg\", \"Helse og omsorg\", \"Annet\")\ntable(stressdata$bransje)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n          Annet Helse og omsorg \n            229             347 \n```\n:::\n:::\n\n\n## Complexity ICT er et aspekt med digitalt stress\n\nFem items som tilhører \"Complexity ICT\" er bra korrelert\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomp <- select(stressdata, contains(\"COMP\"))#velge ut bare disse 5\ncor(comp) %>% round(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      COMP1 COMP2 COMP3 COMP4 COMP5\nCOMP1   1.0   0.8   0.8   0.7   0.7\nCOMP2   0.8   1.0   0.8   0.7   0.7\nCOMP3   0.8   0.8   1.0   0.7   0.7\nCOMP4   0.7   0.7   0.7   1.0   0.8\nCOMP5   0.7   0.7   0.7   0.8   1.0\n```\n:::\n:::\n\n\n## Oppsummere complexity med en summeskår\n\nLage summeskår som et mål på Complexity stress\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstressdata$complexity <- stressdata$COMP1+stressdata$COMP2+stressdata$COMP3+stressdata$COMP4+stressdata$COMP5\nsummary(stressdata$complexity)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   5.00   11.00   19.00   18.66   26.00   35.00 \n```\n:::\n\n```{.r .cell-code}\nhist(stressdata$complexity)\n```\n\n::: {.cell-output-display}\n![](slides3a_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## Kan vi forklare noe i variasjonen til complexity stress?\n\nKan kjønn og alder forklare noe av stresset?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(complexity ~ kjønn+age, data=stressdata) \nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = complexity ~ kjønn + age, data = stressdata)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-15.1812  -7.1336  -0.1302   6.9751  18.6830 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 17.22973    1.44498  11.924  < 2e-16 ***\nkjønnmann   -2.91213    0.88412  -3.294  0.00105 ** \nage          0.04760    0.03322   1.433  0.15244    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 8.452 on 573 degrees of freedom\nMultiple R-squared:  0.02046,\tAdjusted R-squared:  0.01704 \nF-statistic: 5.983 on 2 and 573 DF,  p-value: 0.002681\n```\n:::\n:::\n\n\n-   p-verdien til F-testen er signifikant. Det betyr at kjønn og alder forklarer mer enn ingenting\n-   $R^2$ er imidlertid veldig lav\n\n## Endre modell\n\nTa bort alder og ta heller med bransje\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(complexity ~ kjønn+bransje, data=stressdata) \nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = complexity ~ kjønn + bransje, data = stressdata)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-16.3573  -6.3573   0.3255   6.3696  19.3255 \n\nCoefficients:\n                       Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             14.6745     0.6052  24.247   <2e-16 ***\nkjønnmann               -0.1764     0.8628  -0.204    0.838    \nbransjeHelse og omsorg   6.6828     0.7071   9.452   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.875 on 573 degrees of freedom\nMultiple R-squared:  0.1495,\tAdjusted R-squared:  0.1466 \nF-statistic: 50.38 on 2 and 573 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n-   p-verdien til F-testen er signifikant og $R^2$ er mye høyere nå\n-   Nå er ikke kjønn signifikant lengre.\n\n## Helsesektor er full av kvinner..\n\nDet er helsesektoren som forklarer stress! Grunnen til at kjønn var signifikant før var at det er mange damer i den stressfulle helsesektoren\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstressdata %>% group_by(bransje) %>% summarise(andel_menn=mean(kjønn==\"mann\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  bransje         andel_menn\n  <chr>                <dbl>\n1 Annet               0.358 \n2 Helse og omsorg     0.0980\n```\n:::\n:::\n\n\n## Bransje og lederansvar\n\nTa bort kjønn og ta med lederansvar\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(complexity ~ leder+bransje, data=stressdata) \nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = complexity ~ leder + bransje, data = stressdata)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-16.3492  -6.3492   0.3539   6.3871  19.3539 \n\nCoefficients:\n                       Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             14.6461     0.5786  25.314   <2e-16 ***\nlederTRUE               -0.1327     0.9649  -0.138    0.891    \nbransjeHelse og omsorg   6.7031     0.6958   9.633   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.875 on 573 degrees of freedom\nMultiple R-squared:  0.1495,\tAdjusted R-squared:  0.1465 \nF-statistic: 50.36 on 2 and 573 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nLeder er ikke signifikant.\n\n## Utdanningsnivå og stress\n\nUtdanningsnivå er på ordinal skala så vi gjør det om til factor:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(complexity ~ education+bransje, data=stressdata) \nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = complexity ~ education + bransje, data = stressdata)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-16.6117  -6.3274   0.2403   6.5246  19.3824 \n\nCoefficients:\n                       Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             15.0441     1.3507  11.138   <2e-16 ***\neducation               -0.1422     0.4095  -0.347    0.729    \nbransjeHelse og omsorg   6.7098     0.6727   9.975   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.875 on 573 degrees of freedom\nMultiple R-squared:  0.1497,\tAdjusted R-squared:  0.1467 \nF-statistic: 50.42 on 2 and 573 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nUtdanningsnivå er heller ikke signifikant prediktor\n\n## Parsimony = Enkelhetsprinsippet\n\nIronisk nok ender vi opp med en enkel regresjon! Det er bare bransje som forklarer stress i våre data (15% er forklart, 85% er ikke forklart)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(complexity ~ bransje, data=stressdata) \nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = complexity ~ bransje, data = stressdata)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-16.3401  -6.3401   0.3886   6.3886  19.3886 \n\nCoefficients:\n                       Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             14.6114     0.5200   28.10   <2e-16 ***\nbransjeHelse og omsorg   6.7287     0.6699   10.04   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.869 on 574 degrees of freedom\nMultiple R-squared:  0.1495,\tAdjusted R-squared:  0.148 \nF-statistic: 100.9 on 1 and 574 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Når $Y$ er binær: Logistisk regresjon\n\n-   I multippel regresjon er $Y$ kontinuerlig\n    -   For eksempel $Y$= well-being på en skala fra 0-10\n    -   Modellen gir forventet well-being gitt feks kjønn og alder\n-   Hvis $Y$ er binær så må vi bruke *logistisk* regresjon\n    -   For eksempel $Y$=depressiv (Ja/Nei)\n    -   Modellen gir da odds/sannsynlighet for at en person er depressiv, gitt feks kjønn og alder\n\n## Eksempel: Extramarital affairs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(AER)#install first if needed\ndata(\"Affairs\")#loader datasettet\nsummary(Affairs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    affairs          gender         age         yearsmarried    children \n Min.   : 0.000   female:315   Min.   :17.50   Min.   : 0.125   no :171  \n 1st Qu.: 0.000   male  :286   1st Qu.:27.00   1st Qu.: 4.000   yes:430  \n Median : 0.000                Median :32.00   Median : 7.000            \n Mean   : 1.456                Mean   :32.49   Mean   : 8.178            \n 3rd Qu.: 0.000                3rd Qu.:37.00   3rd Qu.:15.000            \n Max.   :12.000                Max.   :57.00   Max.   :15.000            \n religiousness     education       occupation        rating     \n Min.   :1.000   Min.   : 9.00   Min.   :1.000   Min.   :1.000  \n 1st Qu.:2.000   1st Qu.:14.00   1st Qu.:3.000   1st Qu.:3.000  \n Median :3.000   Median :16.00   Median :5.000   Median :4.000  \n Mean   :3.116   Mean   :16.17   Mean   :4.195   Mean   :3.932  \n 3rd Qu.:4.000   3rd Qu.:18.00   3rd Qu.:6.000   3rd Qu.:5.000  \n Max.   :5.000   Max.   :20.00   Max.   :7.000   Max.   :5.000  \n```\n:::\n\n```{.r .cell-code}\nAffairs$utro <- ifelse(Affairs$affairs == 0, 0, 1)#binær variabel\n```\n:::\n\n\n## Logistisk regresjon når $Y$= 0/1\n\nVi ønsker å bruke rating og children som prediktorer for utroskap Modellen er $$ log(\\frac{p}{1-p})=\\beta_0+ \\beta_1 rating + \\beta_2 children + \\epsilon$$\n\nHer er $p$ sannsynlighet for utroskap, og $\\frac{p}{1-p}$ er *oddsen* Oddsen er alltid positiv men når vi tar logaritmen så får vi dekket både negative og positive tall!\n\nTolkningen av $\\beta$-ene blir mer komplisert!\n\n## I R bruker vi glm() funksjonen\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_mod <- glm(utro ~ factor(children) +rating, data=Affairs, family=\"binomial\")\nsummary(log_mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = utro ~ factor(children) + rating, family = \"binomial\", \n    data = Affairs)\n\nCoefficients:\n                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)          0.28200    0.40264   0.700   0.4837    \nfactor(children)yes  0.55309    0.24291   2.277   0.0228 *  \nrating              -0.47532    0.08608  -5.522 3.36e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 675.38  on 600  degrees of freedom\nResidual deviance: 632.80  on 598  degrees of freedom\nAIC: 638.8\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\n## Tolkning av $\\beta$ i logistisk regresjon\n\nSå barn øker log odds for utroskap, og høyer rating reduserer log odds for utroskap. Vi kan fjerne log ved å bruke eksponentialfunksjon\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp(coef(log_mod))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        (Intercept) factor(children)yes              rating \n          1.3257757           1.7386247           0.6216858 \n```\n:::\n:::\n\n\nTolkning: barn øker oddsen for utroskap med 74% og at en enhets økning i rating reduserer oddsen med 38%\n",
    "supporting": [
      "slides3a_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}